// cart.php Date :- 17-08-2024
 <!-- <?php while ($row = $wish_res->fetch_assoc()) {
                                                $img = explode(",", $row["images"]);
                                          ?>
                                          <tr class="position-relative" data-id="<?php echo $row['id']; ?>" data-price="<?php echo $row['product_selling_price']; ?>">
                                                <th scope="row" class="pe-5 ps-8 py-7 shop-product">
                                                      <div class="d-flex align-items-center">
                                                            <div class="ms-6 me-7">
                                                                  <img src="./assets/images/products/<?php echo $img[0]; ?>" class="lazy-image" width="75" height="100" alt="Natural Coconut Cleansing Oil">
                                                            </div>
                                                            <div>
                                                                  <p class="fw-500 mb-1 text-body-emphasis"><?php echo $row["name"]; ?></p>
                                                                  <p class="card-text">
                                                                        <span class="fs-13px fw-500 text-decoration-line-through pe-3">$<?php echo $row["product_price"]; ?></span>
                                                                        <span class="fs-15px fw-bold text-body-emphasis">$<?php echo $row["product_selling_price"]; ?></span>
                                                                  </p>
                                                            </div>
                                                      </div>
                                                </th>
                                                <td class="align-middle">
                                                      <div class="input-group position-relative shop-quantity">
                                                            <a href="#" class="shop-down position-absolute z-index-2" data-action="decrease"><i class="far fa-minus"></i></a>
                                                            <input type="number" class="form-control form-control-sm px-10 py-4 fs-6 text-center border-0" value="<?php echo $row["quantity"]; ?>" required readonly>
                                                            <a href="#" class="shop-up position-absolute z-index-2" data-action="increase"><i class="far fa-plus"></i></a>
                                                      </div>
                                                </td>
                                                <td class="align-middle">
                                                      <p class="mb-0 text-body-emphasis fw-bold mr-xl-11 total-price">$<?php echo $row["product_selling_price"] * $row["quantity"]; ?></p>
                                                </td>
                                                <td class="align-middle text-end pe-8">
                                                      <button type="submit" name="removepro" value="<?php echo $row["id"]; ?>" class=" border-0 bg-transparent text-secondary">
                                                            <i class="fa fa-times"></i>
                                                      </button>
                                                </td>
                                          </tr>
                                    <?php } ?>
                                    <tr class="position-relative opacity-50">
                                          <th scope="row" class="pe-5 ps-8 py-7 shop-product">
                                                <div class="d-flex align-items-center">
                                                      <div class="ms-6 me-7">
                                                            <img src="#"
                                                                  data-src="../assets/images/products/product-04-75x100.jpg"
                                                                  class="lazy-image" width="75" height="100"
                                                                  alt="Natural Coconut Cleansing Oil">
                                                      </div>
                                                      <div class>
                                                            <p class="fw-500 mb-1 text-body-emphasis">Cleansing Balm</p>
                                                            <p class="card-text">
                                                                  <span
                                                                        class="fs-13px fw-500 text-decoration-line-through pe-3">$39.00</span>
                                                                  <span
                                                                        class="fs-15px fw-bold text-body-emphasis">$29.00</span>
                                                            </p>
                                                      </div>
                                                </div>
                                                <div class="position-absolute top-0 start-0">
                                                      <span
                                                            class="badge rounded-0 text-uppercase fs-14px px-5 py-4 product-stock ls-1 fw-semibold p-0">out
                                                            of stock</span>
                                                </div>
                                          </th>
                                          <td class="align-middle">
                                                <div class="input-group position-relative shop-quantity">
                                                      <a href="#" class="shop-down position-absolute z-index-2"><i
                                                                  class="far fa-minus"></i></a>
                                                      <input name="number" type="number"
                                                            class="form-control form-control-sm px-10 py-4 fs-6 text-center border-0"
                                                            value="1" required disabled>
                                                      <a href="#" class="shop-up position-absolute z-index-2"><i
                                                                  class="far fa-plus"></i>
                                                      </a>
                                                </div>
                                          </td>
                                          <td class="align-middle">
                                                <p class="mb-0 text-body-emphasis fw-bold mr-xl-11"></p>
                                          </td>
                                          <td class="align-middle text-end pe-8">
                                                <button type="submit" name="removepro" class=" border-0 bg-transparent text-secondary">
                                                      <i class="fa fa-times"></i>
                                                </button>
                                          </td>
                                    </tr>
                                    <tr>
                                          <td class="pt-5 pb-10 position-relative bg-body ps-0 left">
                                                <a href="grid-layout.php" title="Countinue Shopping"
                                                      class="btn btn-outline-dark me-8 text-nowrap my-5">
                                                      Countinue Shopping
                                                </a>
                                          </td>
                                    </tr> -->


// indian rupess :- â‚¹



// onlinepayment.php (05-09-2024)

<?php

include_once "database/db.php";


if (!$user) {
      header("location:login.php");
}

$user_id = $_SESSION["userId"];
$temp_query = " SELECT  *  FROM  order_details WHERE user_id=$user_id AND payment= false";
$temp_query_result = mysqli_query($conn, $temp_query);

if ($temp_query_result->num_rows == 0) {
      header("location:login.php");
      exit();
}
$row = $temp_query_result->fetch_assoc();

// print_r($row["totalAfterCoupen"]*100);

require("razorpay-php-master/Razorpay.php");

if (isset($_POST["paymentMethod"])) {

      $method = $_POST["paymentMethod"];
      $payment = $_POST["payment"];
      $stmt = $conn->prepare("INSERT INTO order_payments (order_id, payment_method) VALUES (?, ?)");
      $stmt->bind_param("is", $payment, $method);
      $stmt->execute();
      $stmt->close();

      if ($method == "COD") {
            header("location:orderd.php");
      } else {
            header("location:onlinepayment.php");
      }
}
//  else {
//       die();
// }

include_once "header.php";

?>
<?php
// require('vendor/autoload.php');

use Razorpay\Api\Api;

$KEY_ID = "rzp_live_C7ayx7PaJJkARf";
$SECRET_KEY = "4BdgF5N5FitWBRBA6QwZrVwi";

$api = new Api($KEY_ID, $SECRET_KEY);

// Amount should be in paisa, so INR 10 = 1000
$orderData = [
      // 'receipt'         => 3456,
      'amount'          => $row["totalAfterCoupen"] * 100, // 1000 rupees in paise
      'currency'        => 'INR',
      // 'payment_capture' => 1 // auto capture
];

$razorpayOrder = $api->order->create($orderData);
$razorpayOrderId = $razorpayOrder['id'];

$_SESSION['razorpay_order_id'] = $razorpayOrderId;

$data = [
      "key"               => 'YOUR_KEY_ID',
      "amount"            => $orderData['amount'],
      "name"              => "Your Company Name",
      "description"       => "Test Transaction",
      "image"             => "https://your_logo_url",
      "prefill"           => [
            "name"              => "Customer Name",
            "email"             => "customer@example.com",
            "contact"           => "9999999999",
      ],
      "notes"             => [
            "address"           => "Your Address",
            "merchant_order_id" => "12312321",
      ],
      "theme"             => [
            "color"             => "#F37254"
      ],
      "order_id"          => $razorpayOrderId,
];

// $json = json_encode($data);
?>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<form action="verify.php" method="POST">
      <script
            src="https://checkout.razorpay.com/v1/checkout.js"
            data-key="<?php echo $data['key']; ?>"
            data-amount="<?php echo $data['amount']; ?>"
            data-currency="INR"
            data-order_id="<?php echo $data['order_id']; ?>"
            data-buttontext="Pay with Razorpay"
            data-name="<?php echo $data['name']; ?>"
            data-description="<?php echo $data['description']; ?>"
            data-image="<?php echo $data['image']; ?>"
            data-prefill.name="<?php echo $data['prefill']['name']; ?>"
            data-prefill.email="<?php echo $data['prefill']['email']; ?>"
            data-theme.color="<?php echo $data['theme']['color']; ?>"></script>
      <input type="hidden" name="hidden">
</form>

<?php include_once "footer.php"; ?>
